From 43ac839c168c652e52320267b0504e6933cb9f60 Mon Sep 17 00:00:00 2001
From: Martin Kroeker <martin@ruby.chemie.uni-freiburg.de>
Date: Sun, 22 Jul 2018 09:19:19 +0200
Subject: [PATCH] Unset memory table entry, not just the temporary pointer to
 it on shutdown

to fix crash with multiple instances of OpenBLAS, #1692
---
 driver/others/memory.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/driver/others/memory.c b/driver/others/memory.c
index 98bcfb216..3bf6ba019 100644
--- a/driver/others/memory.c
+++ b/driver/others/memory.c
@@ -1279,7 +1279,7 @@ void blas_shutdown(void){
       struct alloc_t *alloc_info = local_memory_table[thread][pos];
       if (alloc_info) {
         alloc_info->release_func(alloc_info);
-        alloc_info = (void *)0;
+        local_memory_table[thread][pos] = (void *)0;
       }
     }
   }
